<!DOCTYPE html>
<html>
<head>
  <meta charset="utf-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>내 주변 헬스장 찾기</title>
  <style>
  
  	@font-face {
	        font-family: 'HakgyoansimChilpanjiugaeB';
	        src: url('fonts/Hakgyoansim_Chilpanjiugae_TTF_B.ttf') format('truetype');
	        font-weight: bold;
	        font-style: normal;
	    }
	
	    /* 전체 적용 */
	    * {
	        font-family: 'HakgyoansimChilpanjiugaeB', sans-serif !important;
	        font-size: 24px !important;
	    }
	
	    html, body {
	        font-family: 'HakgyoansimChilpanjiugaeB', sans-serif !important;
	        font-size: 24px !important;
	    }
  
    * {
      margin: 0;
      padding: 0;
      box-sizing: border-box;
      font-family: 'Noto Sans KR', sans-serif;
    }
    
    body {
      background-color: #a8e6cf;
      color: #333;
      overflow-x: hidden;
    }
    
    .wave-top {
      width: 100%;
      height: 50px;
      background-color: #a8e6cf;
      border-radius: 0 0 50% 50%;
      margin-bottom: -1px;
    }
    
    .container {
      max-width: 1200px;
      margin: 0 auto;
      padding: 20px;
    }
    
    .main-content {
      background-color: #deeef7;
      border-radius: 30px;
      padding: 20px;
      margin-bottom: 30px;
      position: relative;
      box-shadow: 0 4px 15px rgba(0, 0, 0, 0.05);
    }
    
    .section-indicator {
      display: inline-flex;
      align-items: center;
      margin-bottom: 15px;
      font-size: 14px;
      color: #3f72af;
      font-weight: 500;
    }
    
    .section-indicator::before {
      content: '';
      display: inline-block;
      width: 8px;
      height: 8px;
      background-color: #3f72af;
      border-radius: 50%;
      margin-right: 8px;
    }
    
    h1 {
      font-size: 28px;
      margin-bottom: 20px;
      color: #333;
      font-weight: 700;
    }
    
    .card {
      background-color: white;
      border-radius: 20px;
      padding: 20px;
      margin-bottom: 20px;
      box-shadow: 0 4px 15px rgba(0, 0, 0, 0.05);
      display: flex;
      flex-direction: column;
    }
    
    .card-header {
      margin-bottom: 15px;
      display: flex;
      justify-content: space-between;
      align-items: center;
    }
    
    .card-title {
      font-size: 18px;
      font-weight: 700;
      color: #333;
      display: flex;
      align-items: center;
    }
    
    .card-tag {
      display: inline-block;
      background-color: #ffeead;
      color: #f76c6c;
      font-size: 12px;
      padding: 3px 8px;
      border-radius: 12px;
      font-weight: 700;
      margin-left: 10px;
    }
    
    .card-content {
      display: flex;
      align-items: flex-start;
      gap: 20px;
    }
    
    .card-text {
      flex: 1;
      font-size: 14px;
      line-height: 1.5;
      color: #666;
    }
    
    .card-image {
      flex: 0 0 auto;
      width: 120px;
      text-align: center;
    }
    
    .card-image img {
      max-width: 110%;
      height: auto;
    }
    
    .feature-list {
      list-style: none;
      margin: 15px 0;
    }
    
    .feature-list li {
      position: relative;
      padding-left: 20px;
      margin-bottom: 8px;
      font-size: 14px;
    }
    
    .feature-list li::before {
      content: '•';
      position: absolute;
      left: 0;
      color: #f76c6c;
      font-weight: bold;
    }
    
    .action-button {
      display: inline-flex;
      align-items: center;
      background-color: #f76c6c;
      color: white;
      font-size: 14px;
      padding: 8px 18px;
      border-radius: 30px;
      border: none;
      cursor: pointer;
      transition: background-color 0.3s;
      font-weight: 500;
      margin-top: 15px;
      align-self: flex-start;
    }
    
    .action-button:hover {
      background-color: #e85858;
    }
    
    .action-button svg {
      margin-left: 8px;
    }
    
    .image-row {
      display: flex;
      gap: 10px;
      margin-top: 15px;
      overflow-x: auto;
      padding-bottom: 5px;
    }
    
    .image-row img {
      width: 150px;
      height: 100px;
      object-fit: cover;
      border-radius: 10px;
      box-shadow: 0 2px 5px rgba(0, 0, 0, 0.1);
    }
    
    .map-container {
      display: flex;
      flex-direction: column;
      gap: 20px;
    }
    
    @media (min-width: 768px) {
      .map-container {
        flex-direction: row;
      }
    }
    
    #map {
      flex: 1;
      height: 400px;
      border-radius: 20px;
      overflow: hidden;
      box-shadow: 0 4px 15px rgba(0, 0, 0, 0.05);
    }
    
    #gym-list-container {
      flex: 0 0 300px;
      background-color: white;
      border-radius: 20px;
      overflow: hidden;
      box-shadow: 0 4px 15px rgba(0, 0, 0, 0.05);
      display: flex;
      flex-direction: column;
    }
    
    .list-header {
      background-color: #f76c6c;
      color: white;
      padding: 15px;
      font-size: 16px;
      font-weight: 600;
      display: flex;
      justify-content: space-between;
      align-items: center;
    }
    
    .location-info {
      display: flex;
      padding: 15px;
      background-color: #fafafa;
      border-bottom: 1px solid #eee;
      align-items: center;
    }
    
    .location-icon {
      background-color: #a8e6cf;
      color: #333;
      width: 36px;
      height: 36px;
      border-radius: 50%;
      display: flex;
      align-items: center;
      justify-content: center;
      margin-right: 12px;
      font-size: 18px;
    }
    
    .address {
      font-size: 12px;
      color: #888;
    }
    
    #gym-list {
      overflow-y: auto;
      flex: 1;
      max-height: 300px;
    }
    
    .gym-item {
      padding: 15px;
      border-bottom: 1px solid #eee;
      cursor: pointer;
      transition: background-color 0.2s;
    }
    
    .gym-item:hover {
      background-color: #f8f9fa;
    }
    
    .gym-item h3 {
      font-size: 14px;
      margin-bottom: 5px;
      color: #333;
    }
    
    .gym-item p {
      font-size: 12px;
      color: #888;
      display: flex;
      align-items: center;
      margin-top: 6px;
    }
    
    .gym-item p i {
      margin-right: 6px;
      color: #f76c6c;
      font-size: 14px;
    }
    
    .distance {
      color: #f76c6c !important;
      font-weight: 600;
    }
    
    .loading {
      display: flex;
      justify-content: center;
      align-items: center;
      height: 100px;
      font-size: 14px;
      color: #888;
    }
    
    .loading-spinner {
      border: 3px solid #f3f3f3;
      border-top: 3px solid #f76c6c;
      border-radius: 50%;
      width: 20px;
      height: 20px;
      animation: spin 1s linear infinite;
      margin-right: 10px;
    }
    
    @keyframes spin {
      0% { transform: rotate(0deg); }
      100% { transform: rotate(360deg); }
    }
    
    .infowindow {
      padding: 10px;
      background: white;
      border-radius: 10px;
      box-shadow: 0 2px 10px rgba(0, 0, 0, 0.1);
      max-width: 250px;
    }
    
    .infowindow h3 {
      font-size: 14px;
      margin-bottom: 5px;
      color: #333;
    }
    
    .infowindow p {
      font-size: 12px;
      color: #888;
      margin-top: 3px;
    }
    
    .info-button {
      background-color: #f76c6c;
      color: white;
      border: none;
      padding: 5px 10px;
      border-radius: 15px;
      font-size: 12px;
      cursor: pointer;
      margin-top: 5px;
    }
    
    .map-section {
      margin-top: 20px;
    }
    
    .map-section-title {
      display: flex;
      align-items: center;
      margin-bottom: 15px;
    }
    
    .map-section-title h2 {
      font-size: 18px;
      color: #333;
      margin-right: 10px;
    }
    
    .map-section-tag {
      background-color: #ddf3ff;
      color: #3f72af;
      padding: 4px 10px;
      border-radius: 15px;
      font-size: 12px;
      font-weight: 500;
    }
    
    .map-character {
      position: absolute;
      width: 80px;
      height: auto;
    }
    
    .character-top-right {
      top: -40px;
      right: 20px;
    }
    
    .character-bottom-right {
      bottom: -40px;
      right: 20px;
    }
    
    .wave-bottom {
      width: 100%;
      height: 50px;
      background-color: #a8e6cf;
      border-radius: 50% 50% 0 0;
      margin-top: -1px;
    }
    
    .section-content {
      margin-top: 20px;
    }
    
    .icon-text {
      display: flex;
      align-items: center;
      font-size: 14px;
      color: #666;
      margin-bottom: 5px;
    }
    
    .icon-text i {
      width: 20px;
      margin-right: 8px;
      color: #f76c6c;
    }
  </style>
  <link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0/css/all.min.css" rel="stylesheet">
  <link href="https://fonts.googleapis.com/css2?family=Noto+Sans+KR:wght@400;500;700&display=swap" rel="stylesheet">
</head>
<body>
  <div class="wave-top"></div>
  
  <div class="container">
    <div class="main-content">
      <div class="section-indicator">Home</div>
      <h1>내 주변 헬스장 찾기</h1>
      
      <div class="card">
        <div class="card-header">
          <div class="card-title">
            서비스 소개
            <span class="card-tag">About</span>
          </div>
        </div>
        <div class="card-content">
          <div class="card-text">
            <p>내 위치를 중심으로 반경 2km 이내의 헬스장을 쉽고 빠르게 찾아볼 수 있는 서비스입니다. <br> 현재 위치를 기반으로 가까운 헬스장을 지도에서 확인하고, 거리순으로 정렬된 목록을 통해 쉽게 비교해 보세요.</p>
            
            <ul class="feature-list">
              <li>실시간 위치 기반 검색</li>
              <li>거리순으로 정렬된 헬스장 목록</li>
              <li>헬스장 상세 정보 제공</li>
              <li>2km 반경 내 시설만 필터링</li>
            </ul>
            
            <div class="icon-text">
              <i class="fas fa-info-circle"></i>
              <span>위치 정보 사용 허용이 필요합니다.</span>
            </div>
            <div class="icon-text">
              <i class="fas fa-map-marker-alt"></i>
              <span>현재 위치를 중심으로 검색합니다.</span>
            </div>
          </div>
          <div class="card-image">
            <img src="img/dumbbell_woman.png" alt="헬스장 아이콘">
          </div>
        </div>
      </div>
      
      <div class="map-section">
        <div class="map-section-title">
          <h2>헬스장 지도</h2>
          <span class="map-section-tag">2km 반경 검색</span>
        </div>
        
        <div class="section-content map-container">
          <div id="map"></div>
          
          <div id="gym-list-container">
            <div class="list-header">
              <span>주변 헬스장 목록</span>
              <span id="gym-count">0개</span>
            </div>
            
            <div class="location-info">
              <div class="location-icon">
                <i class="fas fa-map-marker-alt"></i>
              </div>
              <div>
                <div id="current-location">위치 확인 중...</div>
                <div class="address" id="current-address">주소 확인 중...</div>
              </div>
            </div>
            
            <div id="gym-list" class="gym-list">
              <div class="loading">
                <div class="loading-spinner"></div>
                <span>내 주변 헬스장을 검색 중입니다...</span>
              </div>
            </div>
          </div>
        </div>
      </div>
      
      <img src="img/animal_mark10_usagi.png" alt="캐릭터" class="map-character character-top-right">
    </div>
    
    <div class="main-content">
      <div class="section-indicator">Information</div>
      <h1>이용 안내</h1>
      
      <div class="card">
        <div class="card-header">
          <div class="card-title">
            헬스장 검색 방법
            <span class="card-tag">Guide</span>
          </div>
        </div>
        <div class="card-content">
          <div class="card-text">
            <p>내 위치 기반으로 가까운 헬스장을 찾는 방법입니다. 더 정확한 결과를 위해 위치 정보 접근을 허용해 주세요.</p>
            
            <ul class="feature-list">
              <li>웹브라우저의 위치 정보 접근을 허용합니다</li>
              <li>지도에 표시된 마커를 클릭하면 상세 정보가 표시됩니다</li>
              <li>목록에서 원하는 헬스장을 클릭하면 지도에서 위치를 확인할 수 있습니다</li>
              <li>거리순으로 정렬된 목록에서 가장 가까운 헬스장을 찾아보세요</li>
            </ul>
            
            <button class="action-button">
              자세히 보기
              <svg width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
                <path d="M5 12h14"></path>
                <path d="M12 5l7 7-7 7"></path>
              </svg>
            </button>
          </div>
          <div class="card-image">
            <img src="img/taisou_boy.png" alt="이용 안내 이미지">
          </div>
        </div>
      </div>
      
      <div class="card">
        <div class="card-header">
          <div class="card-title">
            자주 묻는 질문
            <span class="card-tag">FAQ</span>
          </div>
        </div>
        <div class="card-content">
          <div class="card-text">
            <ul class="feature-list">
              <li>위치 정보가 정확하지 않아요: 브라우저 설정에서 위치 정보 접근 권한을 확인해 주세요</li>
              <li>헬스장이 보이지 않아요: 주변에 헬스장이 없거나 데이터가 없을 수 있습니다</li>
              <li>정보가 정확하지 않아요: 카카오맵 API의 데이터를 사용하고 있습니다</li>
              <li>다른 종류의 운동 시설도 볼 수 있나요?: 현재는 헬스장만 검색 가능합니다</li>
            </ul>
          </div>
        </div>
      </div>
      
    </div>
  </div>
  
  <div class="wave-bottom"></div>

  <!-- SDK 설정 -->
  <script src="https://dapi.kakao.com/v2/maps/sdk.js?appkey=2477856358d728b82dcd21bf2ffa4b9f&libraries=services&autoload=false"></script>

  <script>
    kakao.maps.load(function () {
      const mapContainer = document.getElementById('map');
      const mapOption = {
        center: new kakao.maps.LatLng(36.3494984, 127.3849276),
        level: 4
      };
      const map = new kakao.maps.Map(mapContainer, mapOption);
      const ps = new kakao.maps.services.Places();
      const geocoder = new kakao.maps.services.Geocoder();
      
      // 마커와 인포윈도우 저장을 위한 배열
      const markers = [];
      const infowindows = [];
      let gymList = [];
      
      // 현재 위치 가져오기
     
      if (navigator.geolocation) {
        navigator.geolocation.getCurrentPosition(function (position) {
          const lat = position.coords.latitude;
          const lon = position.coords.longitude;
          const locPosition = new kakao.maps.LatLng(lat, lon);
          map.setCenter(locPosition);
          
          // 내 위치 주소 가져오기
          geocoder.coord2Address(lon, lat, function(result, status) {
            if (status === kakao.maps.services.Status.OK) {
              const address = result[0].address.address_name;
              document.getElementById('current-address').textContent = address;
              document.getElementById('current-location').textContent = '내 현재 위치';
            }
          });

          // 내 위치 마커 표시
          const myMarker = new kakao.maps.Marker({
            map: map,
            position: locPosition,
            title: "내 위치",
            image: new kakao.maps.MarkerImage(
              "https://t1.daumcdn.net/localimg/localimages/07/mapapidoc/markerStar.png",
              new kakao.maps.Size(24, 35)
            )
          });
          
          // 반경 원 표시
          const circle = new kakao.maps.Circle({
            center: locPosition,
            radius: 2000, // 2km 반경
            strokeWeight: 2,
            strokeColor: '#f76c6c',
            strokeOpacity: 0.8,
            strokeStyle: 'dashed',
            fillColor: '#f76c6c',
            fillOpacity: 0.15
          });
          circle.setMap(map);

          // '헬스장' 검색
          ps.keywordSearch("헬스장", function (data, status) {
            if (status === kakao.maps.services.Status.OK) {
              // 목록 로딩 완료
              document.getElementById('gym-list').innerHTML = '';
              document.getElementById('gym-count').textContent = data.length + '개';
              
              // 검색 데이터 위치 계산 및 정렬
              gymList = data.map(place => {
                const placePosition = new kakao.maps.LatLng(place.y, place.x);
                const distance = getDistance(locPosition, placePosition);
                return {
                  ...place,
                  distance: distance,
                  position: placePosition
                };
              })
              // 거리순 정렬
              .filter(place => place.distance <= 2000) // 2km 이내만 필터링
              .sort((a, b) => a.distance - b.distance);
              
              document.getElementById('gym-count').textContent = gymList.length + '개';
              
              gymList.forEach((place, i) => {
                // 마커 생성
                const marker = new kakao.maps.Marker({
                  map: map,
                  position: place.position
                });
                markers.push(marker);
                
                // 인포윈도우 생성
                const iwContent = `
                  <div class="infowindow">
                    <h3>${place.place_name}</h3>
                    <p><i class="fas fa-map-marker-alt"></i> ${place.address_name}</p>
                    <p><i class="fas fa-phone"></i> ${place.phone || '정보 없음'}</p>
                    <p><i class="fas fa-walking"></i> ${formatDistance(place.distance)}</p>
                  </div>
                `;
                
                const infowindow = new kakao.maps.InfoWindow({
                  content: iwContent
                });
                infowindows.push(infowindow);
                
                // 마커 클릭 이벤트
                kakao.maps.event.addListener(marker, 'click', function () {
                  // 모든 인포윈도우 닫기
                  infowindows.forEach(iw => iw.close());
                  // 현재 인포윈도우 열기
                  infowindow.open(map, marker);
                });
                
                // 목록에 항목 추가
                const listItem = document.createElement('div');
                listItem.className = 'gym-item';
                listItem.innerHTML = `
                  <h3>${place.place_name}</h3>
                  <p><i class="fas fa-map-marker-alt"></i> ${place.address_name}</p>
                  ${place.phone ? `<p><i class="fas fa-phone"></i> ${place.phone}</p>` : ''}
                  <p class="distance"><i class="fas fa-walking"></i> ${formatDistance(place.distance)}</p>
                `;
                
                // 목록 항목 클릭 이벤트
                listItem.addEventListener('click', function() {
                  // 지도 중심 이동
                  map.setCenter(place.position);
                  // 모든 인포윈도우 닫기
                  infowindows.forEach(iw => iw.close());
                  // 현재 인포윈도우 열기
                  infowindow.open(map, marker);
                  
                  // 목록 아이템 강조
                  const items = document.querySelectorAll('.gym-item');
                  items.forEach(item => item.style.backgroundColor = '');
                  listItem.style.backgroundColor = '#f8f9fa';
                });
                
                document.getElementById('gym-list').appendChild(listItem);
              });
              
              // 검색 결과가 없을 경우
              if (gymList.length === 0) {
                document.getElementById('gym-list').innerHTML = `
                  <div style="padding: 20px; text-align: center; color: #888;">
                    <i class="fas fa-exclamation-circle" style="font-size: 24px; margin-bottom: 10px;"></i>
                    <p>2km 반경 내에 헬스장이 없습니다.</p>
                    <p>검색 반경을 넓히거나 다른 위치에서 검색해 보세요.</p>
                  </div>
                `;
              }
            } else {
              document.getElementById('gym-list').innerHTML = `
                <div style="padding: 20px; text-align: center; color: #888;">
                  <i class="fas fa-exclamation-circle" style="font-size: 24px; margin-bottom: 10px;"></i>
                  <p>검색 결과를 불러오는데 실패했습니다.</p>
                  <p>잠시 후 다시 시도해 주세요.</p>
                </div>
              `;
            }
          }, {
            location: locPosition,
            radius: 3000 // 3km 검색 반경 (필터링은 2km로)
          });
        }, function() {
          alert("위치 정보를 가져오는데 실패했습니다. 설정에서 위치 접근 권한을 확인해주세요.");
          document.getElementById('current-location').textContent = '위치 정보 없음';
          document.getElementById('current-address').textContent = '위치 정보를 허용해주세요';
        });
      } else {
        alert("이 브라우저는 위치 정보 사용을 지원하지 않습니다!");
        document.getElementById('current-location').textContent = '위치 정보 없음';
        document.getElementById('current-address').textContent = '위치 정보를 허용해주세요';
      }
      
  
      
      // 거리 계산 함수
      function getDistance(latlng1, latlng2) {
        const earthRadius = 6371; // km
        const lat1 = latlng1.getLat() * (Math.PI/180);
        const lat2 = latlng2.getLat() * (Math.PI/180);
        const latDiff = (latlng2.getLat() - latlng1.getLat()) * (Math.PI/180);
        const lngDiff = (latlng2.getLng() - latlng1.getLng()) * (Math.PI/180);
        
        const a = Math.sin(latDiff/2) * Math.sin(latDiff/2) +
                  Math.cos(lat1) * Math.cos(lat2) *
                  Math.sin(lngDiff/2) * Math.sin(lngDiff/2);
        const c = 2 * Math.atan2(Math.sqrt(a), Math.sqrt(1-a));
        const distance = earthRadius * c * 1000; // 미터 단위
        
        return distance;
      }
      
      // 거리 포맷팅 함수
      function formatDistance(distance) {
        if (distance < 1000) {
          return Math.round(distance) + 'm';
        } else {
          return (distance / 1000).toFixed(1) + 'km';
        }
      }
    });
  </script>
</body>
</html>